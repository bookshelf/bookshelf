<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <meta name="viewport" content="width=device-width">
  <link rel="canonical" href="http://bookshelfjs.org" />
  <link rel="icon" href="docs/images/favicon.ico" />
  <title>Bookshelf.js - Javascript ORM with some Backbone</title>
  <style>
    body {
      font-size: 14px;
      line-height: 22px;
      font-family: Helvetica Neue, Helvetica, Arial;
      background: #FEFFFC;
    }
    .interface {
      font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, sans-serif !important;
    }
    div#sidebar {
      background: #fff;
      position: fixed;
      z-index: 10;
      top: 0; left: 0; bottom: 0;
      width: 200px;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      padding: 15px 0 30px 30px;
      border-right: 1px solid #bbb;
      box-shadow: 0 0 20px #ccc; -webkit-box-shadow: 0 0 20px #ccc; -moz-box-shadow: 0 0 20px #ccc;
    }
      a.toc_title, a.toc_title:visited {
        display: block;
        color: black;
        font-weight: bold;
        margin-top: 15px;
      }
        a.toc_title:hover {
          text-decoration: underline;
        }
        #sidebar .version {
          font-size: 10px;
          font-weight: normal;
        }
      ul.toc_section {
        font-size: 11px;
        line-height: 14px;
        margin: 5px 0 0 0;
        padding-left: 0px;
        list-style-type: none;
        font-family: Lucida Grande;
      }
        .toc_section li {
          cursor: pointer;
          margin: 0 0 3px 0;
        }
          .toc_section li a {
            text-decoration: none;
            color: black;
          }
            .toc_section li a:hover {
              text-decoration: underline;
            }
    div.container {
      position: relative;
      width: 550px;
      margin: 40px 0 50px 260px;
    }
    img#logo {
      width: 450px;
    }
    div.run {
      position: absolute;
      right: 15px;
      width: 26px; height: 18px;
      background: url('docs/images/arrows.png') no-repeat -26px 0;
    }
      div.run:active {
        background-position: -51px 0;
      }
    p, div.container ul {
      margin: 25px 0;
      width: 550px;
    }
      p.warning {
        font-size: 12px;
        line-height: 18px;
        font-style: italic;
      }
      div.container ul {
        list-style: circle;
        padding-left: 15px;
        font-size: 13px;
        line-height: 18px;
      }
        div.container ul li {
          margin-bottom: 10px;
        }
        div.container ul.small {
          font-size: 12px;
        }
    a, a:visited {
      color: #444;
    }
    a:active, a:hover {
      color: #000;
    }
    a.punch {
      display: inline-block;
      background: #4162a8;
      border-top: 1px solid #38538c;
      border-right: 1px solid #1f2d4d;
      border-bottom: 1px solid #151e33;
      border-left: 1px solid #1f2d4d;
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      -ms-border-radius: 4px;
      -o-border-radius: 4px;
      border-radius: 4px;
      -webkit-box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
      -moz-box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
      -ms-box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
      -o-box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
      box-shadow: inset 0 1px 10px 1px #5c8bee, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
      color: #fff;
      font: bold 14px "helvetica neue", helvetica, arial, sans-serif;
      line-height: 1;
      margin-bottom: 15px;
      padding: 8px 0 10px 0;
      text-align: center;
      text-shadow: 0px -1px 1px #1e2d4d;
      text-decoration: none;
      width: 225px;
      -webkit-background-clip: padding-box; }
      a.punch:hover {
        -webkit-box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
        -moz-box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
        -ms-box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
        -o-box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
        box-shadow: inset 0 0px 20px 1px #87adff, 0px 1px 0 #1d2c4d, 0 6px 0px #1f3053, 0 8px 4px 1px #111111;
        cursor: pointer; }
      a.punch:active {
        -webkit-box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
        -moz-box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
        -ms-box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
        -o-box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
        box-shadow: inset 0 1px 10px 1px #5c8bee, 0 1px 0 #1d2c4d, 0 2px 0 #1f3053, 0 4px 3px 0 #111111;
        margin-top: 5px; margin-bottom: 10px }
    a img {
      border: 0;
    }
    h1, h2, h3, h4, h5, h6 {
      padding-top: 20px;
    }
      h2 {
        font-size: 22px;
      }
    b.header {
      font-size: 18px;
      line-height: 35px;
    }
    span.alias {
      font-size: 14px;
      font-style: italic;
      margin-left: 20px;
    }
    table {
      margin: 15px 0 0; padding: 0;
    }
      tr, td {
        margin: 0; padding: 0;
      }
        td {
          padding: 0px 15px 5px 0;
        }
        table .rule {
          height: 1px;
          background: #ccc;
          margin: 5px 0;
        }
    code, pre, tt {
      font-family: Monaco, Consolas, "Lucida Console", monospace;
      font-size: 12px;
      line-height: 18px;
      font-style: normal;
    }
      tt {
        padding: 0px 3px;
        background: #fff;
        border: 1px solid #ddd;
        zoom: 1;
      }
      code {
        margin-left: 20px;
      }
      pre {
        font-size: 12px;
        padding: 2px 0 2px 15px;
        border: 4px solid #bbb; border-top: 0; border-bottom: 0;
        margin: 0px 0 25px;
      }
      img.example_image {
        margin: 0px auto;
      }
        img.example_retina {
          margin: 20px;
          box-shadow: 0 8px 15px rgba(0,0,0,0.4);
        }
    @media only screen and (-webkit-max-device-pixel-ratio: 1) and (max-width: 600px),
           only screen and (max--moz-device-pixel-ratio: 1) and (max-width: 600px) {
      div#sidebar {
        display: none;
      }
      img#logo {
        max-width: 450px;
        width: 100%;
        height: auto;
      }
      div.container {
        width: auto;
        margin-left: 15px;
        margin-right: 15px;
      }
        p, div.container ul {
          width: auto;
        }
    }
    @media only screen and (-webkit-min-device-pixel-ratio: 1.5) and (max-width: 640px),
          only screen and (-o-min-device-pixel-ratio: 3/2) and (max-width: 640px),
          only screen and (min-device-pixel-ratio: 1.5) and (max-width: 640px) {
      img {
        max-width: 100%;
        height: auto;
      }
      div#sidebar {
        -webkit-overflow-scrolling: initial;
        position: relative;
        width: 90%;
        height: 120px;
        left: 0;
        top: -7px;
        padding: 10px 0 10px 30px;
        border: 0;
      }
      img#logo {
        width: auto;
        height: auto;
      }
      div.container {
        margin: 0;
        width: 100%;
      }
      p, div.container ul {
        max-width: 98%;
        overflow-x: scroll;
      }
      table {
        position: relative;
      }
        tr:first-child td {
          padding-bottom: 25px;
        }
        td.text {
          padding: 0;
          position: absolute;
          left: 0;
          top: 48px;
        }
        tr:last-child td.text {
          top: 122px;
        }
      pre {
        overflow: scroll;
      }
    }
  </style>
</head>
<body>

  <div id="sidebar" class="interface">

    <a class="toc_title" href="#">
      Bookshelf.js <span class="version">(0.1.0)</span>
    </a>
    <ul class="toc_section">
      <li>&raquo; <a href="http://github.com/tgriesser/bookshelf">GitHub Repository</a></li>
      <li>&raquo; <a href="http://bookshelfjs.org/docs/bookshelf.html">Annotated Source</a></li>
    </ul>

    <a class="toc_title" href="#introduction">
      Introduction
    </a>

    <a class="toc_title" href="#Initialize">
      Initialize
    </a>

    <a class="toc_title" href="#Model">
      Model
    </a>
    <ul class="toc_section">
      <li>– <a href="#Model-extend">extend</a></li>
      <li>– <a href="#Model-forge">forge</a></li>
      <li>– <a href="#Model-constructor">constructor / initialize</a></li>
      <li>– <a href="#Model-tableName">tableName</a></li>
      <li>– <a href="#Model-idAttribute">idAttribute</a></li>
      <li>– <a href="#Model-id">id</a></li>
      <li>– <a href="#Model-set">set</a></li>
      <li>– <a href="#Model-get">get</a></li>
      <li>– <a href="#Model-fetch">fetch</a></li>
      <li>– <a href="#Model-load">load</a></li>
      <li><b><a href="#Model-relation-types">Relation Types:</a></b></li>
      <li>– <a href="#Model-hasOne">hasOne</a></li>
      <li>– <a href="#Model-hasMany">hasMany</a></li>
      <li>– <a href="#Model-belongsTo">belongsTo</a></li>
      <li>– <a href="#Model-belongsToMany">belongsToMany</a></li>
      <li>&nbsp;&nbsp;- <a href="#Model-attach">attach</a></li>
      <li>&nbsp;&nbsp;- <a href="#Model-detach">detach</a></li>
      <li>&nbsp;&nbsp;- <a href="#Model-withPivot">withPivot</a></li>      
      <li>– <a href="#Model-save">save</a></li>
      <li>– <a href="#Model-destroy">destroy</a></li>
      <li>– <a href="#Model-format">format</a></li>
      <li>– <a href="#Model-parse">parse</a></li>
      <li>– <a href="#Model-toJSON">toJSON</a></li>
      <li>– <a href="#Model-Underscore-Methods"><b>Underscore Methods (6)</b></a></li>      
      <li>– <a href="#Model-query">query</a></li>
      <li>– <a href="#Model-resetQuery">resetQuery</a></li>
      <li>– <a href="#Model-hasTimestamps">hasTimestamps</a></li>
      <li>– <a href="#Model-timestamp">timestamp</a></li>
      <li>– <a href="#Model-defaults">defaults</a></li>
      <li>– <a href="#Model-isNew">isNew</a></li>
      <li>– <a href="#Model-sync">sync</a></li>
      <li>– <a href="#Model-relations">relations</a></li>
      <li>– <a href="#Model-related">related</a></li>
    </ul>

    <a class="toc_title" href="#Collection">
      Collection
    </a>
    <ul class="toc_section">
      <li>– <a href="#Collection-extend">extend</a></li>
      <li>– <a href="#Collection-forge">forge</a></li>
      <li>– <a href="#Collection-model">model</a></li>
      <li>– <a href="#Collection-constructor">constructor / initialize</a></li>
      <li>– <a href="#Collection-models">models</a></li>
      <li>– <a href="#Collection-fetch">fetch</a></li>
      <li>– <a href="#Collection-load">load</a></li>
      <li>– <a href="#Collection-create">create</a></li>
      <li>– <a href="#Collection-save">save (todo)</a></li>
      <li>– <a href="#Collection-parse">parse</a></li>
      <li>– <a href="#Collection-toJSON">toJSON</a></li>
      <li>– <a href="#Collection-query">query</a></li>
      <li>– <a href="#Collection-resetQuery">resetQuery</a></li>
      <li>– <a href="#Collection-sync">sync</a></li>
      <li>– <a href="#Collection-Backbone-Methods"><b>Backbone Methods (19)</b></a></li>
      <li>– <a href="#Collection-Underscore-Methods"><b>Underscore Methods (28)</b></a></li>
    </ul>

    <a class="toc_title" href="#Sync">
      Sync
    </a>
    <ul class="toc_section">
      <li>– <a href="#Sync-first">first</a></li>
      <li>– <a href="#Sync-select">select</a></li>
      <li>– <a href="#Sync-insert">insert</a></li>
      <li>– <a href="#Sync-update">update</a></li>
      <li>– <a href="#Sync-del">del / delete</a></li>
    </ul>

    <a class="toc_title" href="#Events">
      Events
    </a>
    <ul class="toc_section">
      <li>- <a href="#Events-catalog"><b>Catalog of Built-in Events</b></a></li>
    </ul>

    <a class="toc_title" href="#Utility">
      Utility
    </a>
    <ul class="toc_section">
      <li>– <a href="#Bookshelf-Backbone">Bookshelf.Backbone</a></li>
      <li>– <a href="#Bookshelf-Knex">Bookshelf.Knex</a></li>
      <li>– <a href="#Bookshelf-Transaction">Bookshelf.Transaction</a></li>
    </ul>

    <a class="toc_title" href="#faq">
      F.A.Q.
    </a>
    
    <a class="toc_title" href="#changelog">
      Change Log
    </a>

  </div>

  <div class="container">

    <p>
      <img id="logo" src="docs/images/bookshelf.png" alt="Bookshelf.js">
    </p>

    <p>
      <b>Bookshelf</b> is a <a href="http://documentup.com/kriskowal/q/">promise based</a> ORM for Node.js,
      built on <a href="http://knexjs.org">Knex query builder</a>. It extends the Model &amp; Collection 
      foundations of Backbone.js, providing <a href="#Bookshelf-Transaction">transaction support</a>, eager/nested-eager relation loading, and 
      support for one-to-one, one-to-many, and many-to-many relations.
    </p>

    <p>
      The project is <a href="http://github.com/tgriesser/bookshelf/">hosted on GitHub</a>,
      and the <a href="docs/bookshelf.html">annotated source code</a> is available,
      as well as a full <a href="https://travis-ci.org/tgriesser/bookshelf">test suite</a>.
    </p>

    <p>
      Bookshelf is available for use under the <a href="http://github.com/tgriesser/bookshelf/blob/master/LICENSE">MIT software license</a>.
    </p>

    <p>
      You can report bugs and discuss features on the
      <a href="http://github.com/tgriesser/bookshelf/issues">GitHub issues page</a>,
      add pages to the <a href="https://github.com/tgriesser/bookshelf/wiki">wiki</a>
      or send tweets to <a href="http://twitter.com/tgriesser">@tgriesser</a>.
    </p>

    <p>
      Bookshelf's dependencies are listed in the <tt>package.json</tt> file, but include
      <a href="http://backbonejs.org">Backbone.js</a> <small>(1.0.x)</small>,
      <a href="http://underscorejs.org/">Underscore.js</a> <small>(1.4.x)</small>,
      <a href="https://github.com/kriskowal/q">q.js</a> <small>(0.8.x)</small>
      for promise flow control, <a href="http://knexjs.org">Knex.js.</a> as the query 
      builder foundation, and <a href="https://github.com/dreamerslab/node.inflection">inflection</a>
      for crafting intelligent defaults for related key and table names.
    </p>

    <h2 id="introduction">Introduction</h2>

    <p>
      Bookshelf aims to provide a simple library for common tasks when querying relational
      databases in javascript, and forming relations between these objects, using ideas from 
      DataMapper and Active Record. At ~900 lines of <a href="docs/bookshelf.html">well documented code</a>, 
      Bookshelf is simple to read, understand, and extend. It doesn't force you to use any specific
      validation scheme, and provides flexible and efficient relation/nested-relation loading, and
      first class transaction support.
    </p>

    <p>
      Bookshelf extends the excellent foundation provided by Backbone.js Models and Collections, 
      using similar patterns, naming conventions, and philosophies to build a lightweight, 
      easy to navigate ORM. If you know how to use Backbone, you probably already know how 
      to use Bookshelf.
    </p>

    <h2 id="Initialize">Bookshelf.Initialize</h2>

    <p>
      Required before using Bookshelf, the initialize performs the setup of the database,
      passing through to Knex's <a href="http://knexjs.org/#Initialize">Initialize</a>.
    </p>

<pre>
Bookshelf.Initialize({
  client: 'mysql',
  connection: {
    host     : 'localhost',
    user     : 'root',
    password : '',
    database : 'your_db',
    charset  : 'utf8'
  }
});
</pre>

    <h2 id="Model">Bookshelf.Model</h2>

    <p>
      <b>Models</b> are simple objects representing individual database rows, specifying the
      <a href="#Model-tableName">tableName</a> and any <a href="#Model-relation-types">relations</a>
      to other models. They can be <a href="#Model-extend">extended</a> with any domain-specific methods,
      which can handle components such as validations, computed properties, and access control.
    </p>

    <p id="Model-extend">
      <b class="header">extend</b><code>Bookshelf.Model.extend(properties, [classProperties])</code>
      <br />
      To create a <b>Model</b> class of your own, you extend <b>Bookshelf.Model</b>
      and provide instance <b>properties</b>, as well as optional
      <b>classProperties</b> to be attached directly to the constructor function.
    </p>

    <p>
      <b>extend</b> correctly sets up the prototype chain, so subclasses created
      with <b>extend</b> can be further extended and subclassed as far as you like.
    </p>

<pre>
var Customer = Bookshelf.Model.extend({

  initialize: function() { ... },

  account: function() { ... },

  login: function() { ... }

});
</pre>

    <p class="warning">
        Brief aside on <tt>super</tt>: JavaScript does not provide
        a simple way to call super &mdash; the function of the same name defined
        higher on the prototype chain. If you override a core function like
        <tt>set</tt>, or <tt>save</tt>, and you want to invoke the
        parent object's implementation, you'll have to explicitly call it, along these lines:
    </p>

<pre>
var Customer = Bookshelf.Model.extend({
  set: function() {
    ...
    Bookshelf.Model.prototype.set.apply(this, arguments);
    ...
  }
});
</pre>

    <p id="Model-forge">
      <b class="header">forge</b><code>Bookshelf.Model.forge(/* args */)</code>
      <br />
      A simple helper function to instantiate a new <tt>Model</tt> without needing <tt>new</tt>.
    </p>

<pre>
var Customer = Bookshelf.Model.extend({
  tableName: 'customers'
});

Customer.forge({item: 'value'}).save().then(function() {
  // ...
});
</pre>  


    <p id="Model-constructor">
      <b class="header">constructor / initialize</b><code>new Model([attributes], [options])</code>
      <br />
      When creating an instance of a model, you can pass in the initial values
      of the <b>attributes</b>, which will be <a href="#Model-set">set</a> on the
      model. If you define an <b>initialize</b> function, it will be invoked when
      the model is created.
    </p>

<pre>
new Book({
  title: "One Thousand and One Nights",
  author: "Scheherazade"
});
</pre>

    <p>
      In rare cases, if you're looking to get fancy,
      you may want to override <b>constructor</b>, which allows
      you to replace the actual constructor function for your model.
    </p>

<pre>
var Books = Bookshelf.Model.extend({
  
  tableName: 'documents',
  
  constructor: function() {
    Bookshelf.Model.apply(this, arguments);
    this.on('beforeQuery', function(model) {
      model.query('where', 'type', '=', 'book');
    });
  }

});
</pre>

    <p>
      The<tt>tableName</tt> and <tt>hasTimestamps</tt> properties
      will be directly attached if passed in the <b>options</b> during model creation.
    </p>

    <p>
      If <tt>{parse: true}</tt> is passed as an <b>option</b>, the <b>attributes</b>
      will first be converted by <a href="#Model-parse">parse</a> before being
      <a href="#Model-set">set</a> on the model.
    </p>

    <p id="Model-tableName">
      <b class="header">tableName</b><code>model.tableName</code>
      <br />
      A required property for any database usage, The <b>tableName</b> property
      refers to the database table name the model will query against.
    </p>

<pre>
var Television = Bookshelf.Model.extend({
  tableName: 'televisions'
});
</pre>

    <p id="Model-idAttribute">
      <b class="header">idAttribute</b><code>model.idAttribute</code>
      <br />
      A database row's unique identifier (typically the primary key) is stored under this attribute.
    </p>

    <p id="Model-id">
      <b class="header">id</b><code>model.id</code>
      <br />
      A special property of models, the <b>id</b> is the unique idenfifer associated 
      named by the <a href="#Model-idAttribute">idAttribute</a>. If you set the <b>id</b> 
      in the attributes hash, it will be copied onto the model as a direct property. 
      Models can be retrieved by id from collections, and the id is used in fetching models and
      building model relations.
    </p>

    <p id="Model-set">
      <b class="header">set</b><code>model.set(attributes, [options])</code>
      <br />
      Set a hash of attributes (one or many) on the model. If any of the attributes
      change the model's state, a <tt>"change"</tt> event will be triggered.
      Change events for specific attributes are also triggered, and you can 
      bind to those as well, for example: <tt>change:title</tt>, and 
      <tt>change:content</tt>. You may also pass individual keys and values.
    </p>

<pre>
customer.set({first_name: "Joe", last_name: "Customer"});

customer.set("telephone", "555-555-1212");
</pre>

    <p id="Model-get">
      <b class="header">get</b><code>model.get(attribute)</code>
      <br />
      Get the current value of an attribute from the model. For example:
      <tt>note.get("title")</tt>
    </p>

    <p id="Model-fetch">
      <b class="header">fetch</b><code>model.fetch([options]).then(function(model) {...</code>
      <br />
      Fetches a model from the database, using any attributes currently set on the model
      to form a <tt>select</tt> query. Returns a promise, which will resolve with the fetched Model,
      or <tt>null</tt> if the model isn't fetched.
    </p>

<pre>
// select * from `books` where `ISBN-13` = '9780440180296'
new Book({'ISBN-13': '9780440180296'})
  .fetch()
  .then(function(model) {
    // outputs 'Slaughterhouse Five'
    console.log(model.get('title'));
  });
</pre>

    <p><b>Eager Loading:</b>
      <br />
      The <tt>withRelated</tt> parameter may be specified to fetch the resource, 
      along with any specified <a href="#Model-relations">relations</a> named on the model. 
      A single property, or an array of properties can be specified as a value for the <tt>withRelated</tt>
      property. The results of these relation queries will be loaded into a <tt>relations</tt> property on
      the model, may be retreived with the <a href="#Model-related">related</a> method, and will 
      be serialized as properties on a <a href="#Model-toJSON">toJSON</a> call unless 
      <tt>{shallow: true}</tt> is passed.
    </p>

<pre>
var Book = Bookshelf.Model.extend({
  tableName: 'books',
  editions: function() {
    return this.hasMany(Edition);
  },
  genre: function() {
    return this.belongsTo(Genre);
  }
})

new Book({'ISBN-13': '9780440180296'}).fetch({
  withRelated: ['genre', 'editions']
}).then(function(result) {
  ...
});
</pre>

    <p id="Model-load">
      <b class="header">load</b><code>model.load(relations, [options]).then(function(model) {...</code>
      <br />
      The <b>load</b> method takes an array of <b>relations</b> to eager load attributes onto a Model, 
      in a similar way that the <tt>withRelated</tt> property works on fetch. Dot separated attributes 
      may be used to specify deep eager loading.
    </p>

<pre>
new Posts().fetch().then(function(collection) {
  collection.at(0)
  .load(['author', 'content', 'comments.tags'])
  .then(function(model) {
    JSON.stringify(model);
  });
});

{
  title: 'post title',
  author: {...},
  content: {...},
  comments: [
    {tags: [...]}, {tags: [...]}
  ]
}
</pre>

    <h3 id="Model-relation-types">Relation Types:</h3>

    <p>
      There are four types of relationships that may be defined between Models and 
      Collections: <a href="#Model-hasOne">hasOne</a>, <a href="#Model-hasMany">hasMany</a>, 
      <a href="#Model-belongsTo">belongsTo</a>, <a href="#Model-belongsToMany">belongsToMany</a>. 
      The relations are specified by created named methods on the model, which return the 
      appropriate relation type.
    </p>

<pre>
var Summary = Bookshelf.Model.extend({tableName: 'summaries'});

var Author = Bookshelf.Model.extend({tableName: 'authors'});

var Owner  = Bookshelf.Model.extend({tableName: 'owners'});

var Book = Bookshelf.Model.extend({
  summary: function() {
    return this.hasOne(Summary);
  },
  owner: function() {
    return this.belongsTo(Author);
  },
  pages: function() {
    return this.hasMany(Pages);
  },
  author: function() {
    return this.belongsToMany(Author);
  }
});

new Book({id: 1}).summary().fetch().then(function(summary) {
  console.log(summary.toJSON());
});
</pre>
    
    <p>
      Relations may also be loaded eagerly, by specifying a <tt>withRelated</tt> option
      during the fetch call.
    </p>

<pre>
new Book({id: 2}).fetch({
  withRelated: ['summary', 'owner', 'pages', 'author']
}).then(function(book) {
  console.log(book.toJSON());
});
</pre>

    <p>
      You may also want to eagerly load related models on a model or collection after it has already been fetched.
      For this, you may use the <a href="#Model-load">load</a> method to specify which relations should be eagerly 
      loaded on the model or collection.
    </p>

<pre>
var accounts = new Accounts();
accounts.fetch()
  .then(function(collection) {
    return collection.at(0).load('account_info');
  })
  .then(function(model) {
    res.json({
      accounts: accounts.toJSON({shallow: true}), 
      current_account: model
    });
  })
  .done();
</pre>


    <p>
      Nested eager loads may be performed, by separating the nested relations with <tt>'.'</tt>.
    </p>

<pre>
new Story({id: 2}).fetch({
  withRelated: ['comments.tags', 'comments.author', 'author']
}).then(function(model) {
  JSON.stringify(model);
});

// performs 5 queries in total, outputting:
{
  id: 2, 
  title: '', 
  author: {...},
  comments: [
    {tags: [{...}, {...}], author: {...}}, 
    {tags: [...], author: {...}}, 
    {tags: [...], author: {...}}
  ]
}

</pre>

    <p id="Model-hasOne">
      <b class="header">hasOne</b><code>model.hasOne(Model, [foreignKey])</code>
      <br />
      A one-to-one relation is a very basic relation, where the model has exactly 
      one of another <b>Model</b>, referenced by a <b>foreignKey</b> in the target <b>Model</b>.
      By default, the foreign key is assumed to be the singular form of the current model,
      followed by <tt>_id</tt>.
    </p>

<pre>
var Record = Bookshelf.Model.extend({
  tableName: 'health_records'
});

var Patient = Bookshelf.Model.extend({
  record: function() {
    return this.hasOne(Record);
  }
});

// select * from `health_records` where `patient_id` = 1;
new Patient({id: 1}).record().fetch(function(model) {
  ...
});
</pre>

    <p>
      If the foreign key is different than the one assumed by the query builder, you may specify
      it in the second argument of the query.
    </p>

    <p id="Model-hasMany">
      <b class="header">hasMany</b><code>model.hasMany(Target, [foreignKey])</code>
      <br />
      Typically the most common relationship type, a <tt>hasMany</tt> is when the <b>model</b>
      has a "one-to-many" relationship with the <b>Target</b> model or collection. The
      <b>model</b> is referenced by a <b>foreignKey</b>, which defaults to the
      <a href="#Model-tableName">tableName</a> of the current model.
    </p>

    <p id="Model-belongsTo">
      <b class="header">belongsTo</b><code>model.belongsTo(Model, [otherKey])</code>
      <br />
      The <tt>belongsTo</tt> defines an inverse one-to-one relation, where the current model is a member
      of another <b>Model</b>, referenced by the <b>otherKey</b> in the target <b>Model</b>.
      By default, the other key is assumed to be the singular form of the target <b>Model</b> with a
      <tt>_id</tt> suffix.
    </p>

<pre>
var Author = Bookshelf.Model.extend({
  
});

// select * from `author` where 
new Book({id: 1}).author().fetch(function() {
  
});
</pre>


    <p id="Model-belongsToMany">
      <b class="header">belongsToMany</b><code>model.belongsToMany(Target, [table], [fKey], [otherKey])</code>
      <br />
      The <tt>belongsToMany</tt> method defines a many-to-many relation, where the current <b>Model</b>
      is joined to one ore more of a <b>Target</b> model through another <b>table</b>. The default name for
      the joining table is the two table names, joined by an underscore, ordered alphabetically. For example, a
      <tt>users</tt> table and an <tt>accounts</tt> table would have a joining table of <tt>accounts_users</tt>.

<pre>
var Account = Bookshelf.Model.extend({
  tableName: 'accounts'
});

var User = Bookshelf.Model.extend({
  
  tableName: 'users',
  
  allAccounts: function () {
    return this.belongsToMany(User);
  },
  
  adminAccounts: function() {
    return this.belongsToMany(User).query('where', 'access', '=', 'admin');
  },
  
  viewAccounts: function() {
    return this.belongsToMany(User).query('where', 'access', '=', 'readonly');
  }

});
</pre>

    <p>
      The default key names in the joining table are the singular version of the table name, followed by <tt>_id</tt>.
      So in the above case, the columns in the joining table would be <tt>account_id</tt>, <tt>user_id</tt>, and
      <tt>access</tt>, which is used as an example of how dynamic relations can be formed using different contexts.
    </p>

    <p id="Model-attach">
      <b class="header">attach</b><code>relation.attach(ids, [options])</code>
      <br />
      
    </p>

    <p id="Model-detach">
      <b class="header">detach</b><code>relation.detach(ids, [options])</code>
      <br />
      
    </p>

    <p id="Model-withPivot">
      <b class="header">withPivot</b><code>relation.withPivot(columns)</code>
      <br />
      The <tt>withPivot</tt> method is used exclusively on <a href="#Model-belongsToMany">belongsToMany</a>
      relations, and allows for additional fields to be pulled from the joining table.
    </p>

<pre>
var Tag = Bookshelf.Model.extend({
  comments: function() {
    return this.belongsToMany(Comment).withPivot(['created_at', 'order']);
  }
});
</pre>

  <p>
    By default, the pivot attributes are defined with the <tt>pivot_</tt> prefix. If you would
    like to specify how they are named on the related models, pass an object with the key/value pairs
    to <tt>withPivot</tt>.
  </p>

<pre>
var Tag = Bookshelf.Model.extend({
  comments: function() {
    return this.belongsToMany(Comment).withPivot({
      created_at: 'comment_created_at', 
      order: 'order'
    });
  }
});

new Tag({id: 1}).comments().fetch().then(function(model) {
  JSON.stringify(model);
  // {id: 1, name: 'tag name', comments: [
  //   {id: 1, comment_created_at: ..., order: ...},
  //   {id: 2, comment_created_at: ..., order: ...}
  // ];
});
</pre>

    <p id="Model-save">
      <b class="header">save</b><code>model.save([params], [options]).then(function(model) {...</code>
      <br />
      The Model's <b>save</b> method is used to perform an <tt>insert</tt> or <tt>update</tt>
      query with the model, dependent on whether the model <a href="#Model-isNew">isNew</a>.
      If you wish to use <tt>update</tt> rather than <tt>insert</tt> or vice versa, the 
      <tt>{method: ...}</tt> option may be specified to explicitly state which 
      <a href="#Sync">sync</a> method to use in the save call. If the method is <tt>update</tt>,
      <tt>{patch: true}</tt> may be specified to only save the items in the <b>params</b> rather than
      the full model.
    </p>

<pre>
new Post({name: 'New Article'}).save().then(function(model) {
  
});
</pre>

    <p id="Model-destroy">
      <b class="header">destroy</b><code>model.destroy</code>
      <br />
      The Model's <b>destroy</b> method performs a <tt>delete</tt> on the model, using the model's
      <a href="#Model-idAttribute">idAttribute</a> to constrain the query.
    </p>

    <p id="Model-attributes">
      <b class="header">attributes</b><code>model.attributes</code>
      <br />
      The <b>attributes</b> property is the internal hash containing the databse row.
    </p>

    <p>
      Please use <a href="#Model-set">set</a> to update the <b>attributes</b>
      instead of modifying them directly. If you'd like to retrieve and munge a
      copy of the model's attributes, use <a href="#Model-toJSON">toJSON</a>
      instead.
    </p>

    <p id="Model-defaults">
      <b class="header">defaults</b><code>model.defaults or model.defaults()</code>
      <br />
      The <b>defaults</b> hash (or function) can be used to specify the default
      attributes for your model. Unlike with Backbone's model defaults, Bookshelf defaults
      are applied when an object is persisted rather than during creation.
    </p>

<pre>
var Meal = Bookshelf.Model.extend({
  defaults: {
    appetizer:  "caesar salad",
    entree:     "ravioli",
    dessert:    "cheesecake"
  }
});

alert("Dessert will be " + (new Meal).get('dessert'));
</pre>

    <p class="warning">
      Remember that in JavaScript, objects are passed by reference, so if you
      include an object as a default value, it will be shared among all instances.
      Instead, define <b>defaults</b> as a function.
    </p>

    <p id="Model-format">
      <b class="header">format</b><code>model.format(attributes, [options])</code>
      <br />
      The <b>format</b> method is used to modify the current state of the model before
      it is persisted to the database. The <b>attributes</b> passed are a shallow clone
      of the model, and are only used for inserting/updating - the current values of the 
      model are left intact.
    </p>    

    <p id="Model-parse">
      <b class="header">parse</b><code>model.parse(response, [options])</code>
      <br />
      The <b>parse</b> method is called whenever a model's data is returned in a 
      <a href="#Model-fetch">fetch</a> call. The function is passed 
      the raw database <tt>response</tt> object, and should return the attributes hash 
      to be <a href="#Model-set">set</a> on the model. The default implementation 
      is a no-op, simply passing through the JSON response. Override this if 
      you need to format the database responses - for example calling <tt>JSON.parse</tt>
      on a text field containing <tt>JSON</tt>, or explicitly typecasting a boolean
      in a <tt>sqlite3</tt> database response.
    </p>

    <p id="Model-toJSON">
      <b class="header">toJSON</b><code>model.toJSON([options])</code>
      <br />
      Return a copy of the model's <a href="#Model-attributes">attributes</a> for JSON stringification.
      If the model has any <a href="#Model-relations">relations</a> defined, this will also call
      <tt>toJSON</tt> on each of the related objects, and include them on the object unless <tt>{shallow: true}</tt>
      is passed as an option. For more information on the use of <tt>toJSON</tt>, check out the 
      <a href="https://developer.mozilla.org/en/JSON#toJSON()_method">JavaScript API for <b>JSON.stringify</b></a>.
    </p>

<pre>
var artist = new Bookshelf.Model({
  firstName: "Wassily",
  lastName: "Kandinsky"
});

artist.set({birthday: "December 16, 1866"});

console.log(JSON.stringify(artist));
</pre>

    <p id="Model-Underscore-Methods">
      <b class="header">Underscore Methods (6)</b>
      <br />
      Bookshelf proxies to <b>Underscore.js</b> to provide 6 object functions
      on <b>Bookshelf.Model</b>. They aren't all documented here, but
      you can take a look at the Underscore documentation for the full details&hellip;
    </p>

    <ul class="small">
      <li><a href="http://underscorejs.org/#keys">keys</a></li>
      <li><a href="http://underscorejs.org/#values">values</a></li>
      <li><a href="http://underscorejs.org/#pairs">pairs</a></li>
      <li><a href="http://underscorejs.org/#invert">invert</a></li>
      <li><a href="http://underscorejs.org/#pick">pick</a></li>
      <li><a href="http://underscorejs.org/#omit">omit</a></li>
    </ul>

<pre>
user.pick('first_name', 'last_name', 'email');

chapters.keys().join(', ');
</pre>

    <p id="Model-query">
      <b class="header">query</b><code>model.query([method], [*parameters])</code>
      <br />
      The <tt>query</tt> method is used to tap into the underlying <a href="http://knexjs.org">Knex</a>
      query builder instance for the current model. If called with no arguments, it will return the query
      builder directly. Otherwise, it will call the specified <tt>method</tt> on the query builder, applying
      any additional arguments from the <tt>model.query</tt> call.
    </p>

<pre>
var qb = model.query();
    qb.where({id: 1}).select().then(function(resp) {...

model
  .query('where', 'other_id', '=', '5')
  .fetch()
  .then(function(model) {
    ...
  });
</pre>

    <p id="Model-resetQuery">
      <b class="header">resetQuery</b><code>model.resetQuery()</code>
      <br />
      Used to reset the internal state of the current query builder instance. This method is
      called internally each time a database action is completed by <tt>Bookshelf.Sync</tt>.
    </p>

    <p id="Model-hasTimestamps">
      <b class="header">hasTimestamps</b><code>model.hasTimestamps</code>
      <br />
      A boolean property on the model, determining whether the <a href="#Model-timestamp">timestamp</a> method will
      be called on a <tt>model.save()</tt> call &mdash; the default value is false.
    </p>

    <p id="Model-timestamp">
      <b class="header">timestamp</b><code>model.timestamp(options)</code>
      <br />
      Sets the timestamp attributes on the model, if <tt>hasTimestamps</tt> is set to true.
      The default implementation is to check if the model <a href="Model-isNew">isNew</a> and
      set the <tt>created_at</tt> and <tt>updated_at</tt> attributes to the current date if it is new,
      and just the <tt>updated_at</tt> attribute if it isn't. You may override this method if you
      wish to use different column names or types for the timestamps.
    </p>

    <p id="Model-clone">
      <b class="header">clone</b><code>model.clone()</code>
      <br />
      Returns a new instance of the model with identical attributes, including any relations
      from the cloned model.
    </p>

    <p id="Model-isNew">
      <b class="header">isNew</b><code>model.isNew()</code>
      <br />
      Checks for the existence of an <a href="#Model-id">id</a> to determine whether the model 
      is considered "new".
    </p>

<pre>
var modelA = new Bookshelf.Model();
modelA.isNew(); // true

var modelB = new Bookshelf.Model({id: 1});
modelB.isNew(); // false
</pre>

    <p id="Model-sync">
      <b class="header">sync</b><code>model.sync(method, model, [options])</code>
      <br />
      Creates and returns a new <a href="#Sync">Bookshelf.Sync</a> instance. Can be overridden for custom behavior.
    </p>

    <p id="Model-relations">
      <b class="header">relations</b><code>model.relations</code>
      <br />
      The <b>relations</b> property is the internal hash containing each of the relations
      (models or collections) loaded on the model with <a href="#Model-load">load</a> or with
      the <tt>withRelated</tt> property during <a href="#Model-fetch">fetch</a>. You can access
      the relation using the <a href="#Model-related">related</a> method on the model.
    </p>    

    <p id="Model-related">
      <b class="header">related</b><code>model.related()</code>
      <br />
      The <b>relations</b> property is the internal hash containing each of the relations
      (models or collections) loaded on the model with <a href="#Model-load">load</a> or with
      the <tt>withRelated</tt> property during <a href="#Model-fetch">fetch</a>. You can access
      the relation using the <a href="#Model-related">related</a> method on the model.
    </p>

    <h2 id="Collection">Bookshelf.Collection</h2>

    <p>
      Collections are ordered sets of models. You can bind <tt>"change"</tt> events
      to be notified when any model in the collection has been modified,
      listen for <tt>"add"</tt> and <tt>"remove"</tt> events, <tt>fetch</tt>
      the collection from the server, and use a full suite of
      <a href="#Collection-Underscore-Methods">Underscore.js methods</a>.
    </p>

    <p>
      Any event that is triggered on a model in a collection will also be
      triggered on the collection directly, for convenience.
      This allows you to listen for changes to specific attributes in any
      model in a collection, for example:
      <tt>Documents.on("change:selected", ...)</tt>
    </p>

    <p id="Collection-extend">
      <b class="header">extend</b><code>Bookshelf.Collection.extend(properties, [classProperties])</code>
      <br />
      To create a <b>Collection</b> class of your own, extend <b>Bookshelf.Collection</b>,
      providing instance <b>properties</b>, as well as optional <b>classProperties</b> to be attached
      directly to the collection's constructor function.
    </p>

    <p id="Collection-forge">
      <b class="header">forge</b><code>Bookshelf.Collection.forge(/* args */)</code>
      <br />
      A simple helper function to instantiate a new <tt>Collection</tt> without needing <tt>new</tt>.
    </p>

<pre>
var Accounts = Bookshelf.Model.extend({
  model: Account
});

Accounts.forge([
  {name: 'Person1'}, 
  {name: 'Person2'}
]).save().then(function() {
  // ...
});
</pre>  

    <p id="Collection-model">
      <b class="header">model</b><code>collection.model</code>
      <br />
      Override this property to specify the model class that the collection
      contains. If defined, you can pass raw attributes objects (and arrays) to
      <a href="#Collection-add">add</a>, <a href="#Collection-create">create</a>,
      and <a href="#Collection-reset">reset</a>, and the attributes will be
      converted into a model of the proper type. Unlike in Backbone.js, the model 
      attribute may not be a polymorphic model.
    </p>

<pre>
var Trilogy = Bookshelf.Collection.extend({
  model: Book
});
</pre>

    <p id="Collection-constructor">
      <b class="header">constructor / initialize</b><code>new Collection([models], [options])</code>
      <br />
      When creating a Collection, you may choose to pass in the initial array
      of <b>models</b>.  The collection's <a href="#Collection-comparator">comparator</a>
      may be included as an option. Passing <tt>false</tt> as the
      comparator option will prevent sorting. If you define an
      <b>initialize</b> function, it will be invoked when the collection is
      created.
    </p>

<pre>
var tabs = new TabSet([tab1, tab2, tab3]);
</pre>

    <p id="Collection-models">
      <b class="header">models</b><code>collection.models</code>
      <br />
      Raw access to the JavaScript array of models inside of the collection. Usually you'll
      want to use <tt>get</tt>, <tt>at</tt>, or the <b>Underscore methods</b>
      to access model objects, but occasionally a direct reference to the array
      is desired.
    </p>

    <p id="Model-parse">
      <b class="header">parse</b><code>model.parse(response, [options])</code>
      <br />
      The <b>parse</b> method is called whenever a collection's data is returned in a 
      <a href="#Collection-fetch">fetch</a> call. The function is passed 
      the raw database <tt>response</tt> array, and should return an array
      to be <a href="#Collection-set">set</a> on the collection. The default implementation 
      is a no-op, simply passing through the JSON response.
    </p>

    <p id="Collection-toJSON">
      <b class="header">toJSON</b><code>collection.toJSON([options])</code>
      <br />
      Return an array containing the <tt>toJSON</tt> for each model in the
      collection. For more information about toJSON, check out
      <a href="https://developer.mozilla.org/en/JSON#toJSON()_method">JavaScript's JSON API</a>.
      You may pass <tt>{shallow: true}</tt> in the options to omit any 
      relations loaded on the collection's models.
    </p>


    <p id="Collection-fetch">
      <b class="header">fetch</b><code>collection.fetch([options])</code>
      <br />
      Fetch the default set of models for this collection from the database,
      resetting the collection when they arrive.
    </p>

    <p id="Collection-load">
      <b class="header">load</b><code>collection.load(relations, options).then(function(collection) {...</code>
      <br />
      The <b>load</b> method can be used to eager load attributes onto a Collection, in a similar way
      that the <tt>withRelated</tt> property works on <a href="#Collection-fetch">fetch</a>. Nested eager 
      loads can be specified by separating the nested relations with <tt>'.'</tt>.
    </p>

<pre>
new Story({id: 2}).fetch({
  withRelated: ['comments.tags', 'comments.author', 'author']
}).then(function(model) {
  JSON.stringify(model);
});    
</pre>

    <p id="Collection-create">
      <b class="header">create</b><code>collection.create(relations, options).then(function(collection) {...</code>
      <br />
      Convenience to create a new instance of a model within a collection. Equivalent to instantiating a 
      model with a hash of attributes, saving the model to the database, and adding the model to the collection
      after being successfully created. Returns a promise, resolving with the new model.
    </p>

    <p id="Collection-save">
      <b class="header">save</b><code>collection.save(options).then(function(collection) {...</code>
      <br />
      The <b>save</b> method intelligently saves any models on the collection, inserting new models and updating
      existing models where appopriate. It will check the attribute list on each model and batch queries where possible,
      and only save existing models that have been changed since they were last sync'ed with the database.
    </p>

    <p id="Collection-query">
      <b class="header">query</b><code>collection.query([method], [*parameters])</code>
      <br />
      The <tt>query</tt> method is used to tap into the underlying <a href="http://knexjs.org">Knex</a>
      query builder instance for the current collection. If called with no arguments, it will return the query
      builder directly. Otherwise, it will call the specified <tt>method</tt> on the query builder, applying
      any additional arguments from the <tt>collection.query</tt> call.
    </p>

<pre>
var qb = collection.query();
    qb.where({id: 1}).select().then(function(resp) {...

collection
  .query('where', 'other_id', '=', '5')
  .fetch()
  .then(function(collection) {
    ...
  });
</pre>

    <p id="Collection-resetQuery">
      <b class="header">resetQuery</b><code>collection.resetQuery()</code>
      <br />
      Used to reset the internal state of the current query builder instance. This method is
      called internally each time a database action is completed by <tt>Bookshelf.Sync</tt>.
    </p>

    <p id="Collection-sync">
      <b class="header">sync</b><code>collection.sync(collection, [options])</code>
      <br />
      Creates and returns a new <a href="#Sync">Bookshelf.Sync</a> instance. Can be overridden for custom behavior.
    </p>

    <p id="Collection-Backbone-Methods">
      <b class="header">Backbone Methods (19)</b>
      <br />
      Bookshelf also proxies to <b>Backbone.js</b> for any of the core Collection methods
      that don't need modification for the ORM. The Backbone documentation 
      applies equally for Bookself, and can be used to read more on these methods.
    </p>

    <ul>
      <li><a href="http://backbonejs.org/#Collection-add">add</a></li>
      <li><a href="http://backbonejs.org/#Collection-remove">remove</a></li>
      <li><a href="http://backbonejs.org/#Collection-reset">reset</a></li>
      <li><a href="http://backbonejs.org/#Collection-set">set</a></li>
      <li><a href="http://backbonejs.org/#Collection-get">get</a></li>
      <li><a href="http://backbonejs.org/#Collection-at">at</a></li>
      <li><a href="http://backbonejs.org/#Collection-push">push</a></li>
      <li><a href="http://backbonejs.org/#Collection-pop">pop</a></li>
      <li><a href="http://backbonejs.org/#Collection-unshift">unshift</a></li>
      <li><a href="http://backbonejs.org/#Collection-shift">shift</a></li>
      <li><a href="http://backbonejs.org/#Collection-slice">slice</a></li>
      <li><a href="http://backbonejs.org/#Collection-length">length</a></li>
      <li><a href="http://backbonejs.org/#Collection-comparator">comparator</a></li>
      <li><a href="http://backbonejs.org/#Collection-sort">sort</a></li>
      <li><a href="http://backbonejs.org/#Collection-pluck">pluck</a></li>
      <li><a href="http://backbonejs.org/#Collection-where">where</a></li>
      <li><a href="http://backbonejs.org/#Collection-findWhere">findWhere</a></li>
      <li><a href="http://backbonejs.org/#Collection-clone">clone</a></li>
    </ul>

    <p id="Collection-Underscore-Methods">
      <b class="header">Underscore Methods (28)</b>
      <br />
      Just as with <b>Backbone</b>, Bookshelf proxies to <b>Underscore.js</b> to provide 28 iteration functions
      on <b>Bookshelf.Collection</b>. They aren't all documented here, but
      you can take a look at the Underscore documentation for the full details&hellip;
    </p>

    <ul class="small">
      <li><a href="http://underscorejs.org/#each">forEach (each)</a></li>
      <li><a href="http://underscorejs.org/#map">map (collect)</a></li>
      <li><a href="http://underscorejs.org/#reduce">reduce (foldl, inject)</a></li>
      <li><a href="http://underscorejs.org/#reduceRight">reduceRight (foldr)</a></li>
      <li><a href="http://underscorejs.org/#find">find (detect)</a></li>
      <li><a href="http://underscorejs.org/#filter">filter (select)</a></li>
      <li><a href="http://underscorejs.org/#reject">reject</a></li>
      <li><a href="http://underscorejs.org/#all">every (all)</a></li>
      <li><a href="http://underscorejs.org/#any">some (any)</a></li>
      <li><a href="http://underscorejs.org/#include">include (contains)</a></li>
      <li><a href="http://underscorejs.org/#invoke">invoke</a></li>
      <li><a href="http://underscorejs.org/#max">max</a></li>
      <li><a href="http://underscorejs.org/#min">min</a></li>
      <li><a href="http://underscorejs.org/#sortBy">sortBy</a></li>
      <li><a href="http://underscorejs.org/#groupBy">groupBy</a></li>
      <li><a href="http://underscorejs.org/#sortedIndex">sortedIndex</a></li>
      <li><a href="http://underscorejs.org/#shuffle">shuffle</a></li>
      <li><a href="http://underscorejs.org/#toArray">toArray</a></li>
      <li><a href="http://underscorejs.org/#size">size</a></li>
      <li><a href="http://underscorejs.org/#first">first (head, take)</a></li>
      <li><a href="http://underscorejs.org/#initial">initial</a></li>
      <li><a href="http://underscorejs.org/#rest">rest (tail)</a></li>
      <li><a href="http://underscorejs.org/#last">last</a></li>
      <li><a href="http://underscorejs.org/#without">without</a></li>
      <li><a href="http://underscorejs.org/#indexOf">indexOf</a></li>
      <li><a href="http://underscorejs.org/#lastIndexOf">lastIndexOf</a></li>
      <li><a href="http://underscorejs.org/#isEmpty">isEmpty</a></li>
      <li><a href="http://underscorejs.org/#chain">chain</a></li>
    </ul>

  <h2 id="Sync">Bookshelf.Sync</h2>

    <p>
      The <b>Bookshelf.Sync</b> object handles all database communication for models and collections.
      Unlike Backbone's <tt>sync</tt> method, <b>Bookshelf.Sync</b> is a constructor taking two arguments:
      the current <tt>model</tt> (or collection) and any <tt>options</tt> needed for 
      the sync method being performed. It comes with five built in 
      methods: <a href="#Sync-first">first</a>, <a href="#Sync-select">select</a>, 
      <a href="#Sync-insert">insert</a>, <a href="#Sync-update">update</a>, and 
      <a href="#Sync-del">del</a> (delete).
    </p>

    <p id="Sync-first">
      <b class="header">first</b><code>sync.first([options]).then(function(model) {...</code>
      <br />
      Used by the model, the <tt>first</tt> method selects the first matching and returns a promise,
      resolving with the model or collection originally passed in the the <a href="#Sync">Bookshelf.Sync</a>.
    </p>

    <p id="Sync-select">
      <b class="header">select</b><code>sync.select([options]).then(function(model) {...</code>
      <br />
      Used by models and collections, the <tt>select</tt> method selects rows from the database based on the 
      <a href="#Model-tableName">tableName</a> and <a href="#Model-idAttribute">idAttrribute</a>, along with 
      any custom query constraints.
    </p>

    <p id="Sync-insert">
      <b class="header">insert</b><code>sync.insert([options]).then(function(model) {...</code>
      <br />
      Used by models, and relations, the <tt>insert</tt> method inserts a single model, based on the
      <a href="#Model-tableName">tableName</a> and any <a href="#Model-relation-types">relation constraints</a>,
      returning a promise which resolves with the inserted model.
    </p>

    <p id="Sync-update">
      <b class="header">update</b><code>sync.update([options]).then(function(model) {...</code>
      <br />
      Used by models, and relations, the <tt>update</tt> method inserts a single model, based on the
      <a href="#Model-tableName">tableName</a>, <a href="#Model-idAtribute">idAtribute</a> and any custom
      <a href="#Model-query">query</a> or <a href="#Model-relation-types">relation</a> constraints,
      returning a promise which resolves with the inserted model.
    </p>

    <p id="Sync-del">
      <b class="header">del</b><code>sync.del([options]).then(function(model) {...</code>
      <br />
      Used by models, collections, and relations, the <tt>del</tt> method removes one or more models,
      based on the <a href="#Model-tableName">tableName</a>, <a href="#Model-idAtribute">idAtribute</a> 
      and any custom <a href="#Model-query">query</a> or <a href="#Model-relation-types">relation</a> constraints,
      returning a promise which resolves with no arguments. If no <a href="#Model-idAtribute">idAtribute</a> or
      custom constraints have been defined, the promise will fail.
    </p>

  <h2 id="Events">Bookshelf.Events</h2>

    <p>
      Unlike in Backbone, <tt>Events</tt> are not a prominent feature of Bookshelf. Models are 
      typically short lived, so binding to events isn't quite as useful.
    </p>

    <p id="Events-catalog">
      <b class="header">Catalog of Events</b>
      <br />
      Here's the complete list of recognized Bookshelf events, with arguments.
      Other events from <tt>Backbone</tt> might be triggered, but aren't officially supported unless they
      are noted in this list. You're also free to trigger your own events on Models and Collections and
      The <tt>Bookshelf</tt> object itself mixes in <tt>Events</tt>, and can be used to emit any 
      global events that your application needs.
    </p>

    <p><b>Model:</b></p>

    <ul class="small">
      <li><b>"create"</b> (model, resp, options) &mdash; when a model is removed from a collection. </li>
      <li><b>"update"</b> (model, resp, options) &mdash; when a model is removed from a collection. </li>
      <li><b>"destroy"</b> (model, resp, options) &mdash; when a model is <a href="#Model-destroy">destroyed</a>. </li>
      <li><b>"beforeSave"</b> (model, method, options) &mdash; last line before a model is persisted. </li>
      <li><b>"beforeDestroy"</b> (model, method, options) &mdash; last line before a model is destroyed. </li>
      <li><b>"change"</b> (model, options) &mdash; when a model's attributes have changed. </li>
      <li><b>"change:[attribute]"</b> (model, value, options) &mdash; when a specific attribute has been updated. </li>
    </ul>

    <p><b>Collection:</b></p>

    <ul class="small">
      <li><b>"reset"</b> (collection, options) &mdash; when the collection's entire contents have been replaced. </li>
    </ul>

    <p><b>General:</b></p>

     <ul class="small">
      <li><b>"all"</b> &mdash; this special event fires for <i>any</i> triggered event, passing the event name as the first argument. </li>
    </ul>

  <h2 id="Utility">Utility</h2>

    <p id="Bookshelf-Backbone">
      <b class="header">Bookshelf.Backbone</b>
      <br />
      A reference to the copy of Backbone used to create the Bookshelf objects can be accessed
      from <tt>Bookshelf.Backbone</tt>. This can be helpful if you want to use Models &amp; Collections
      elsewhere on the server, and ensure they are compatible with the Bookshelf objects.
    </p>

    <p id="Bookshelf-Knex">
      <b class="header">Bookshelf.Knex</b>
      <br />
      A reference to the <tt>Knex.js</tt> instance being used by Bookshelf.
    </p>

    <p id="Bookshelf-Transaction">
      <b class="header">Bookshelf.Transaction</b>
      <br />
      An alias to <a href="http://knexjs.org/#Transaction">Knex.Transaction</a>, for convenient 
      transaction support. The transaction object must be passed along in the options of any relevant
      <tt>Bookshelf.Sync</tt> calls, to ensure all queries are on the same connection. 
      The entire transaction block is a promise that will resolve when the transaction is 
      committed, or fail if the transaction is rolled back.
    </p>

<pre>
Bookshelf.Transaction(function(t) {
  
  new Bookshelf({name: 'Old Books'}).save({
    transacting: t
  }).then(function(model) {

    return Q.all(_.map([
      {title: 'Canterbury Tales'},
      {title: 'Moby Dick'},
      {title: 'Hamlet'}
    ], function(info) {
      
      // Some validation could take place here.
      return new Book(info)
        .save('shelf_id', model.id, {transacting: t});

    }));
  
  })
  .then(function(rows) {
    t.commit(rows.length + ' new books saved!');
  }, t.rollback);

}).then(function(msg) {

  // 3 new books saved!
  console.log(msg);

}, function() {

  console.log('Error saving the books.');

});
</pre>

    <h2 id="faq">F.A.Q.</h2>

    <p id="faq-debug">
      <b class="header">How do I debug.</b><br />
      If you pass <tt>{debug: true}</tt> as one of the options in your initialize settings, you can see
      all of the query calls being made. Sometimes you need to dive a bit further into
      the various calls and see what all is going on behind the scenes. I'd recommend 
      <a href="https://github.com/dannycoates/node-inspector">node-inspector</a>, which allows you to debug
      code with <tt>debugger</tt> statements like you would in the browser.
    </p>

    <p id="faq-nonode">
      <b class="header">Can I use Bookshelf outside of Node.js</b><br />
      While it primarily targets Node.js, all dependencies are browser compatible, and
      it could be adapted to work with other javascript environments supporting a <tt>sqlite3</tt> 
      database, by providing a custom <a href="http://knexjs.org/#Adapters">Knex adapter</a>.
    </p>

    <h2 id="changelog">Change Log</h2>

    <p>
      <b class="header">0.1.0</b> &mdash; <small><i>TBD</i></small><br />
      Initial Bookshelf release.
    </p>

  </div>
  <script src="docs/public/scripts/ga.js" type="text/javascript" charset="utf-8"></script>
</body>
</html>