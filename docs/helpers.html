<!DOCTYPE html>

<html>
<head>
  <title>helpers.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="bookshelf.html">
                bookshelf.js
              </a>
            
              
              <a class="source" href="collection.html">
                collection.js
              </a>
            
              
              <a class="source" href="eager.html">
                eager.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="helpers.html">
                helpers.js
              </a>
            
              
              <a class="source" href="model.html">
                model.js
              </a>
            
              
              <a class="source" href="relation.html">
                relation.js
              </a>
            
              
              <a class="source" href="sync.html">
                sync.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>helpers.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>(define) { <span class="string">"use strict"</span>;

define(<span class="keyword">function</span>(require, exports, module) {

  <span class="keyword">var</span> _ = require(<span class="string">'./ext/underscore'</span>)._;

  exports.Helpers = {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>If there are no arguments, return the current object&#39;s
query builder (or create and return a new one). If there are arguments,
call the query builder with the first argument, applying the rest.
If the first argument is an object, assume the keys are query builder
methods, and the values are the arguments for the query.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    query: <span class="keyword">function</span>(obj, args) {
      obj._knex || (obj._knex = obj.builder(_.result(obj, <span class="string">'tableName'</span>)));
      <span class="keyword">if</span> (args.length === <span class="number">0</span>) <span class="keyword">return</span> obj._knex;
      <span class="keyword">var</span> method = args[<span class="number">0</span>];
      <span class="keyword">if</span> (_.isFunction(method)) {
        method.call(obj._knex, obj._knex);
      } <span class="keyword">else</span> <span class="keyword">if</span> (_.isObject(method)) {
        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> method) {
          <span class="keyword">var</span> target = _.isArray(method[key]) ?  method[key] : [method[key]];
          obj._knex[key].apply(obj._knex, target);
        }
      } <span class="keyword">else</span> {
        obj._knex[method].apply(obj._knex, args.slice(<span class="number">1</span>));
      }
      <span class="keyword">return</span> obj;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Finds the specific <code>morphTo</code> table we should be working with, or throws
an error if none is matched.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    morphCandidate: <span class="keyword">function</span>(candidates, foreignTable) {
      <span class="keyword">var</span> Target = _.find(candidates, <span class="keyword">function</span>(Candidate) {
        <span class="keyword">return</span> (_.result(Candidate.prototype, <span class="string">'tableName'</span>) === foreignTable);
      });
      <span class="keyword">if</span> (!Target) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'The target polymorphic model was not found'</span>);
      }
      <span class="keyword">return</span> Target;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Sets the constraints necessary during a <code>model.save</code> call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    saveConstraints: <span class="keyword">function</span>(model, relatedData) {
      <span class="keyword">var</span> data = {};
      <span class="keyword">if</span> (relatedData &amp;&amp; relatedData.type &amp;&amp; relatedData.type !== <span class="string">'belongsToMany'</span>) {
        data[relatedData.key(<span class="string">'foreignKey'</span>)] = relatedData.parentFk;
        <span class="keyword">if</span> (relatedData.isMorph()) data[relatedData.key(<span class="string">'morphKey'</span>)] = relatedData.key(<span class="string">'morphValue'</span>);
      }
      <span class="keyword">return</span> model.set(data);
    }

  };

});

})(
  <span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd ? define : <span class="function"><span class="keyword">function</span> <span class="params">(factory)</span> {</span> factory(require, exports, module); }
);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
